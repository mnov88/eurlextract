{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "GDPR Decision Extraction Schema v5.3 - OpenAI Compatible",
  "description": "OpenAI Structured Outputs compatible version. All fields required with null unions for optional data. No conditional validation - handle in post-processing.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "extraction_metadata",
    "case_identification", 
    "parties_and_violation",
    "article_83_assessment",
    "sanctions_imposed",
    "annual_turnover"
  ],
  "properties": {
    "extraction_metadata": {
      "type": "object",
      "description": "Metadata about the extraction process itself, not the decision.",
      "additionalProperties": false,
      "required": ["schema_version", "extraction_confidence", "extraction_notes", "extraction_timestamp"],
      "properties": {
        "schema_version": { 
          "type": "string", 
          "const": "5.3-openai", 
          "description": "Version of this schema used for extraction." 
        },
        "extraction_confidence": { 
          "type": "number", 
          "minimum": 0, 
          "maximum": 1, 
          "description": "Overall 0–1 confidence in extraction accuracy. Use 0.9+ for clear/complete decisions; 0.7–0.9 for standard; <0.7 for unclear/missing sections." 
        },
        "extraction_notes": { 
          "type": ["string", "null"], 
          "description": "Brief notes on challenges/ambiguities with page/section refs if helpful. Use null if no issues to report." 
        },
        "extraction_timestamp": { 
          "type": "string", 
          "format": "date-time", 
          "description": "ISO 8601 timestamp of extraction." 
        }
      }
    },

    "case_identification": {
      "type": "object",
      "description": "Core identifiers for the decision. Extract from the header/footer/first page.",
      "additionalProperties": false,
      "required": ["case_id", "decision_date", "dpa_country", "language", "one_stop_shop", "lead_sa"],
      "properties": {
        "case_id": { 
          "type": "string", 
          "description": "Official case reference exactly as printed (do not normalize). If multiple, use the primary DPA's reference." 
        },
        "decision_date": { 
          "type": "string", 
          "format": "date", 
          "description": "Date issued (YYYY-MM-DD). Use decision date, not publication or incident date." 
        },
        "dpa_country": { 
          "type": "string", 
          "pattern": "^[A-Z]{2}$", 
          "description": "ISO-3166-1 alpha-2 country code of issuing DPA (uppercase). E.g., 'DE','FR','IE'." 
        },
        "language": { 
          "type": ["string", "null"], 
          "pattern": "^[a-z]{2}$", 
          "description": "ISO-639-1 code of the analyzed text (lowercase). E.g., 'en','de'. Use null if unclear." 
        },
        "one_stop_shop": { 
          "type": "boolean", 
          "description": "True ONLY if the decision explicitly mentions OSS/Art. 60/CSAs/Lead SA cooperation procedure." 
        },
        "lead_sa": { 
          "type": ["string", "null"], 
          "pattern": "^[A-Z]{2}$", 
          "description": "Lead SA (ISO-2) if one_stop_shop=true, otherwise use null. POST-VALIDATION: Verify lead_sa is non-null when one_stop_shop=true." 
        }
      }
    },

    "parties_and_violation": {
      "type": "object",
      "description": "Sanctioned entities and violation specifics (facts + operative part).",
      "additionalProperties": false,
      "required": ["defendants", "infringed_articles", "violation_summary", "affected_data_subjects"],
      "properties": {
        "defendants": {
          "type": "array",
          "minItems": 1,
          "maxItems": 10,
          "description": "All entities that receive sanctions/findings. Order by sanction significance (highest fine first). POST-VALIDATION: Verify exactly one has primary_defendant=true.",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["name", "role", "primary_defendant", "sector", "size_category", "turnover"],
            "properties": {
              "name": { 
                "type": "string", 
                "description": "Complete legal name as written in the operative part (include suffixes; for individuals: 'Private Individual' unless name is public in decision)." 
              },
              "role": { 
                "type": "string", 
                "enum": ["CONTROLLER", "JOINT_CONTROLLER", "PROCESSOR", "UNCLEAR"], 
                "description": "GDPR role as found (Art. 26 for joint, Art. 28 for processor). Use UNCLEAR if disputed/not stated." 
              },
              "primary_defendant": { 
                "type": "boolean", 
                "description": "True for the main entity (usually largest sanction). POST-VALIDATION: Exactly one defendant must have this set to true." 
              },
              "sector": { 
                "type": ["string", "null"], 
                "description": "NACE code if present; otherwise brief description (e.g., 'J61 Telecommunications'). Use null if not specified." 
              },
              "size_category": { 
                "type": "string", 
                "enum": ["MICRO", "SMALL", "MEDIUM", "LARGE", "INDIVIDUAL", "UNKNOWN"], 
                "description": "MICRO<10, SMALL 10–49, MEDIUM 50–249, LARGE≥250; INDIVIDUAL for natural persons; UNKNOWN if not stated." 
              },
              "turnover": {
                "type": ["object", "null"],
                "description": "Per-defendant turnover if explicitly cited in the decision. Use null if not mentioned.",
                "additionalProperties": false,
                "required": ["value", "evidence"],
                "properties": {
                  "value": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["amount", "currency", "year", "scope"],
                    "properties": {
                      "amount": { 
                        "type": "number", 
                        "description": "Numeric turnover amount as printed. Never infer or calculate." 
                      },
                      "currency": { 
                        "type": "string", 
                        "pattern": "^[A-Z]{3}$", 
                        "description": "ISO-4217 (e.g., 'EUR')." 
                      },
                      "year": { 
                        "type": ["integer", "null"], 
                        "description": "Financial year of the turnover (e.g., 2023). Use null if year not specified." 
                      },
                      "scope": { 
                        "type": "string", 
                        "enum": ["WORLDWIDE", "EU_ONLY", "NATIONAL", "UNCLEAR"], 
                        "description": "Geographic scope of the turnover figure." 
                      }
                    }
                  },
                  "evidence": { 
                    "$ref": "#/definitions/evidence_explicit_only",
                    "description": "Must be EXPLICIT basis only for turnover - never infer."
                  }
                }
              }
            }
          }
        },

        "infringed_articles": {
          "type": "array",
          "minItems": 1,
          "uniqueItems": true,
          "items": { "type": "string" },
          "description": "All GDPR articles the DPA found violated, exactly as cited (e.g., 'Article 5(1)(a)', 'Article 32(1)'). Do NOT include articles merely discussed."
        },

        "violation_summary": {
          "type": "string",
          "description": "2–3 sentence factual summary of what the defendant did wrong (data types + processing + scope). Avoid legal analysis."
        },

        "affected_data_subjects": {
          "type": "object",
          "description": "Individuals whose data was affected.",
          "additionalProperties": false,
          "required": ["number", "categories", "special_vulnerability"],
          "properties": {
            "number": { 
              "type": ["number", "null"], 
              "description": "Exact/estimated count if stated; null if not mentioned." 
            },
            "categories": { 
              "type": "array", 
              "items": { 
                "type": "string", 
                "enum": ["EMPLOYEES", "CUSTOMERS", "USERS", "PATIENTS", "STUDENTS", "CHILDREN", "CITIZENS", "MEMBERS", "SUBSCRIBERS", "OTHER", "NONE_SPECIFIED"] 
              }, 
              "description": "Types of affected individuals as stated. Use ['NONE_SPECIFIED'] if not mentioned." 
            },
            "special_vulnerability": { 
              "type": "boolean", 
              "description": "True if the decision emphasizes vulnerable groups (children, patients, etc.)." 
            }
          }
        }
      }
    },

    "article_83_assessment": {
      "type": "object",
      "description": "Article 83(2) factors. For each factor, prefer quotes from the fine calculation/conclusion sections.",
      "additionalProperties": false,
      "required": [
        "factor_a_nature_gravity_duration",
        "factor_b_intentional_negligent",
        "factor_c_mitigation_measures",
        "factor_d_technical_organizational_measures",
        "factor_e_relevant_previous_infringements",
        "factor_f_cooperation",
        "factor_g_categories_of_data",
        "factor_h_notification_manner",
        "factor_i_previous_measures_compliance",
        "factor_j_adherence_to_codes",
        "factor_k_other_factors"
      ],
      "properties": {

        "factor_a_nature_gravity_duration": {
          "type": "object",
          "description": "Art. 83(2)(a): Nature, gravity, duration.",
          "additionalProperties": false,
          "required": ["nature_description", "gravity_assessment", "duration_finding", "number_affected", "processing_scope", "processing_purpose_assessment", "processing_context", "infringement_nature", "damage_types", "direction", "application", "evidence"],
          "properties": {
            "nature_description": { 
              "type": ["string", "null"], 
              "description": "How the DPA characterized the infringement. Use null if not discussed." 
            },
            "gravity_assessment": { 
              "type": "string", 
              "enum": ["MINOR", "MODERATE", "SERIOUS", "VERY_SERIOUS", "NOT_MENTIONED"], 
              "description": "DPA gravity assessment as mapped from wording." 
            },
            "duration_finding": { 
              "type": ["string", "null"], 
              "description": "Duration as stated (e.g., 'Jan 2020–Mar 2023'). Use null if not specified." 
            },
            "number_affected": { 
              "type": ["number", "null"], 
              "description": "Count used in gravity if stated; null otherwise." 
            },
            "processing_scope": {
              "type": ["string", "null"],
              "enum": ["LOCAL", "NATIONAL", "CROSS_BORDER", "EU_WIDE", "GLOBAL", "NOT_MENTIONED", null],
              "description": "Geographic scope of processing operations as assessed by DPA. Use null if not discussed."
            },
            "processing_purpose_assessment": {
              "type": ["object", "null"],
              "description": "Assessment of purpose-related factors. Use null if not assessed by DPA.",
              "additionalProperties": false,
              "required": ["core_activities", "purpose_specification_compliance", "compatible_use_assessment"],
              "properties": {
                "core_activities": { 
                  "type": ["boolean", "null"], 
                  "description": "True if processing is central to controller's core business activities. Use null if not assessed." 
                },
                "purpose_specification_compliance": {
                  "type": ["string", "null"], 
                  "enum": ["COMPLIANT", "PARTIALLY_COMPLIANT", "NON_COMPLIANT", "NOT_ASSESSED", null],
                  "description": "Assessment of purpose specification adequacy under GDPR principles. Use null if not discussed."
                },
                "compatible_use_assessment": {
                  "type": ["string", "null"],
                  "enum": ["COMPATIBLE", "INCOMPATIBLE", "UNCLEAR", "NOT_ASSESSED", null],
                  "description": "Whether subsequent processing was compatible with original purpose. Use null if not discussed."
                }
              }
            },
            "processing_context": {
              "type": ["object", "null"],
              "description": "Contextual factors about the processing environment. Use null if not discussed by DPA.",
              "additionalProperties": false,
              "required": ["business_type", "power_imbalance", "vulnerable_subjects_involved"],
              "properties": {
                "business_type": {
                  "type": ["string", "null"],
                  "enum": ["COMMERCIAL", "NON_PROFIT", "POLITICAL_PARTY", "PUBLIC_AUTHORITY", "OTHER", null],
                  "description": "Type of organization context for processing. Use null if not specified."
                },
                "power_imbalance": { 
                  "type": ["boolean", "null"], 
                  "description": "True if clear imbalance exists (employees, pupils, patients, etc.). Use null if not discussed." 
                },
                "vulnerable_subjects_involved": { 
                  "type": ["boolean", "null"], 
                  "description": "True if vulnerable groups (children, patients, etc.) are specifically mentioned. Use null if not discussed." 
                }
              }
            },
            "infringement_nature": {
              "type": ["string", "null"],
              "enum": ["ISOLATED", "SYSTEMIC", "UNCLEAR", "NOT_ASSESSED", null],
              "description": "Whether infringement was isolated incident or systemic organizational failure. Use null if not assessed."
            },
            "damage_types": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["PHYSICAL", "MATERIAL", "NON_MATERIAL", "NONE_IDENTIFIED"]
              },
              "description": "Types of damage per Recital 75 GDPR. Use ['NONE_IDENTIFIED'] if no damage discussed."
            },
            "direction": { 
              "type": ["string", "null"], 
              "enum": ["AGGRAVATING", "MITIGATING", "NEUTRAL", "UNCLEAR", null], 
              "description": "Direction of this factor. Use null if NOT_MENTIONED." 
            },
            "application": { 
              "type": ["string", "null"], 
              "enum": ["APPLIED", "MENTIONED_ONLY", "REJECTED", "NOT_CONSIDERED", "UNCLEAR", null], 
              "description": "Whether used to set/adjust the amount. Use null if NOT_MENTIONED." 
            },
            "evidence": { 
              "$ref": "#/definitions/evidence_nullable"
            }
          }
        },

        "factor_b_intentional_negligent": {
          "type": "object",
          "description": "Art. 83(2)(b): Intentional or negligent character.",
          "additionalProperties": false,
          "required": ["character_finding", "reasoning", "direction", "application", "evidence"],
          "properties": {
            "character_finding": { 
              "type": "string", 
              "enum": ["INTENTIONAL", "GROSS_NEGLIGENCE", "NEGLIGENCE", "NO_FAULT", "NOT_MENTIONED"]
            },
            "reasoning": { 
              "type": ["string", "null"], 
              "description": "Why the DPA reached this conclusion. Use null if NOT_MENTIONED." 
            },
            "direction": { 
              "type": ["string", "null"], 
              "enum": ["AGGRAVATING", "MITIGATING", "NEUTRAL", "UNCLEAR", null]
            },
            "application": { 
              "type": ["string", "null"], 
              "enum": ["APPLIED", "MENTIONED_ONLY", "REJECTED", "NOT_CONSIDERED", "UNCLEAR", null]
            },
            "evidence": { "$ref": "#/definitions/evidence_nullable" }
          }
        },

        "factor_c_mitigation_measures": {
          "type": "object",
          "description": "Art. 83(2)(c): Actions to mitigate damage.",
          "additionalProperties": false,
          "required": ["measures_taken", "effectiveness", "direction", "application", "evidence"],
          "properties": {
            "measures_taken": { 
              "type": ["string", "null"], 
              "description": "What the defendant did to mitigate. Use null if NOT_MENTIONED." 
            },
            "effectiveness": { 
              "type": "string", 
              "enum": ["EFFECTIVE", "PARTIAL", "INEFFECTIVE", "NONE_TAKEN", "NOT_MENTIONED"]
            },
            "direction": { 
              "type": ["string", "null"], 
              "enum": ["AGGRAVATING", "MITIGATING", "NEUTRAL", "UNCLEAR", null]
            },
            "application": { 
              "type": ["string", "null"], 
              "enum": ["APPLIED", "MENTIONED_ONLY", "REJECTED", "NOT_CONSIDERED", "UNCLEAR", null]
            },
            "evidence": { "$ref": "#/definitions/evidence_nullable" }
          }
        },

        "factor_d_technical_organizational_measures": {
          "type": "object",
          "description": "Art. 83(2)(d): Degree of responsibility (Articles 25/32 TOMs).",
          "additionalProperties": false,
          "required": ["measures_assessment", "specific_failures", "direction", "application", "evidence"],
          "properties": {
            "measures_assessment": { 
              "type": "string", 
              "enum": ["ADEQUATE", "INSUFFICIENT", "SEVERELY_LACKING", "NOT_MENTIONED"]
            },
            "specific_failures": { 
              "type": ["string", "null"], 
              "description": "Key TOM gaps. Use null if NOT_MENTIONED." 
            },
            "direction": { 
              "type": ["string", "null"], 
              "enum": ["AGGRAVATING", "MITIGATING", "NEUTRAL", "UNCLEAR", null]
            },
            "application": { 
              "type": ["string", "null"], 
              "enum": ["APPLIED", "MENTIONED_ONLY", "REJECTED", "NOT_CONSIDERED", "UNCLEAR", null]
            },
            "evidence": { "$ref": "#/definitions/evidence_nullable" }
          }
        },

        "factor_e_relevant_previous_infringements": {
          "type": "object",
          "description": "Art. 83(2)(e): Relevant prior infringements.",
          "additionalProperties": false,
          "required": ["previous_violations", "details", "direction", "application", "evidence"],
          "properties": {
            "previous_violations": { 
              "type": "string", 
              "enum": ["FOUND", "NONE", "NOT_MENTIONED"]
            },
            "details": { 
              "type": ["string", "null"], 
              "description": "If FOUND, give brief details. Use null otherwise." 
            },
            "direction": { 
              "type": ["string", "null"], 
              "enum": ["AGGRAVATING", "MITIGATING", "NEUTRAL", "UNCLEAR", null]
            },
            "application": { 
              "type": ["string", "null"], 
              "enum": ["APPLIED", "MENTIONED_ONLY", "REJECTED", "NOT_CONSIDERED", "UNCLEAR", null]
            },
            "evidence": { "$ref": "#/definitions/evidence_nullable" }
          }
        },

        "factor_f_cooperation": {
          "type": "object",
          "description": "Art. 83(2)(f): Degree of cooperation.",
          "additionalProperties": false,
          "required": ["cooperation_level", "specific_actions", "direction", "application", "evidence"],
          "properties": {
            "cooperation_level": { 
              "type": "string", 
              "enum": ["FULL", "PARTIAL", "MINIMAL", "OBSTRUCTIVE", "NOT_MENTIONED"]
            },
            "specific_actions": { 
              "type": ["string", "null"], 
              "description": "E.g., timely responses, document provision. Use null if NOT_MENTIONED." 
            },
            "direction": { 
              "type": ["string", "null"], 
              "enum": ["AGGRAVATING", "MITIGATING", "NEUTRAL", "UNCLEAR", null]
            },
            "application": { 
              "type": ["string", "null"], 
              "enum": ["APPLIED", "MENTIONED_ONLY", "REJECTED", "NOT_CONSIDERED", "UNCLEAR", null]
            },
            "evidence": { "$ref": "#/definitions/evidence_nullable" }
          }
        },

        "factor_g_categories_of_data": {
          "type": "object",
          "description": "Art. 83(2)(g): Categories of personal data affected.",
          "additionalProperties": false,
          "required": ["data_types", "special_categories", "sensitivity_assessment", "identifiability", "technical_protection", "immediate_damage_risk", "data_volume_per_subject", "direction", "application", "evidence"],
          "properties": {
            "data_types": { 
              "type": "array", 
              "items": { "type": "string" }, 
              "description": "List of data categories. Use empty array if NOT_MENTIONED." 
            },
            "special_categories": { 
              "type": "boolean", 
              "description": "True if Art. 9/10 data involved." 
            },
            "sensitivity_assessment": { 
              "type": "string", 
              "enum": ["LOW", "STANDARD", "HIGH", "VERY_HIGH", "NOT_MENTIONED"],
              "description": "Overall DPA assessment of data sensitivity level."
            },
            "identifiability": {
              "type": ["string", "null"],
              "enum": ["DIRECTLY_IDENTIFIABLE", "INDIRECTLY_IDENTIFIABLE", "PSEUDONYMIZED", "ANONYMIZED", "NOT_SPECIFIED", null],
              "description": "Level of data identifiability as assessed or discussed by DPA. Use null if not discussed."
            },
            "technical_protection": {
              "type": ["string", "null"], 
              "enum": ["ENCRYPTED", "UNPROTECTED", "PARTIALLY_PROTECTED", "NOT_SPECIFIED", null],
              "description": "Technical protection measures in place for the data. Use null if not discussed."
            },
            "immediate_damage_risk": {
              "type": ["boolean", "null"],
              "description": "True if data dissemination would cause immediate damage/distress (outside Art 9/10 scope). Use null if not assessed."
            },
            "data_volume_per_subject": {
              "type": ["string", "null"],
              "enum": ["MINIMAL", "MODERATE", "EXTENSIVE", "COMPREHENSIVE_PROFILE", "NOT_ASSESSED", null],
              "description": "Amount of data per individual data subject as factor in sensitivity. Use null if not discussed."
            },
            "direction": { 
              "type": ["string", "null"], 
              "enum": ["AGGRAVATING", "MITIGATING", "NEUTRAL", "UNCLEAR", null],
              "description": "Direction of this factor. Use null if NOT_MENTIONED."
            },
            "application": { 
              "type": ["string", "null"], 
              "enum": ["APPLIED", "MENTIONED_ONLY", "REJECTED", "NOT_CONSIDERED", "UNCLEAR", null],
              "description": "Whether used to set/adjust the amount. Use null if NOT_MENTIONED."
            },
            "evidence": { "$ref": "#/definitions/evidence_nullable" }
          }
        },

        "factor_h_notification_manner": {
          "type": "object",
          "description": "Art. 83(2)(h): How the infringement became known.",
          "additionalProperties": false,
          "required": ["notification_method", "timeliness", "direction", "application", "evidence"],
          "properties": {
            "notification_method": { 
              "type": "string", 
              "enum": ["SELF_REPORT", "DATA_BREACH_NOTIFICATION", "COMPLAINT", "MEDIA_REPORT", "OTHER_DPA", "DPA_INVESTIGATION", "WHISTLEBLOWER", "OTHER", "NOT_MENTIONED"]
            },
            "timeliness": { 
              "type": ["string", "null"], 
              "description": "Statements about timely/delayed notification. Use null if not discussed." 
            },
            "direction": { 
              "type": ["string", "null"], 
              "enum": ["AGGRAVATING", "MITIGATING", "NEUTRAL", "UNCLEAR", null]
            },
            "application": { 
              "type": ["string", "null"], 
              "enum": ["APPLIED", "MENTIONED_ONLY", "REJECTED", "NOT_CONSIDERED", "UNCLEAR", null]
            },
            "evidence": { "$ref": "#/definitions/evidence_nullable" }
          }
        },

        "factor_i_previous_measures_compliance": {
          "type": "object",
          "description": "Art. 83(2)(i): Compliance with previously ordered measures.",
          "additionalProperties": false,
          "required": ["compliance_status", "details", "direction", "application", "evidence"],
          "properties": {
            "compliance_status": { 
              "type": "string", 
              "enum": ["FULL_COMPLIANCE", "PARTIAL_COMPLIANCE", "NON_COMPLIANCE", "NOT_APPLICABLE", "NOT_MENTIONED"]
            },
            "details": { 
              "type": ["string", "null"], 
              "description": "Describe previous measures if applicable. Use null if none." 
            },
            "direction": { 
              "type": ["string", "null"], 
              "enum": ["AGGRAVATING", "MITIGATING", "NEUTRAL", "UNCLEAR", null]
            },
            "application": { 
              "type": ["string", "null"], 
              "enum": ["APPLIED", "MENTIONED_ONLY", "REJECTED", "NOT_CONSIDERED", "UNCLEAR", null]
            },
            "evidence": { "$ref": "#/definitions/evidence_nullable" }
          }
        },

        "factor_j_adherence_to_codes": {
          "type": "object",
          "description": "Art. 83(2)(j): Adherence to codes of conduct/certifications.",
          "additionalProperties": false,
          "required": ["adherence_status", "specific_codes", "direction", "application", "evidence"],
          "properties": {
            "adherence_status": { 
              "type": "string", 
              "enum": ["ADHERED", "VIOLATED", "NOT_APPLICABLE", "NOT_MENTIONED"]
            },
            "specific_codes": { 
              "type": ["string", "null"], 
              "description": "Name any specific codes/certifications. Use null if none." 
            },
            "direction": { 
              "type": ["string", "null"], 
              "enum": ["AGGRAVATING", "MITIGATING", "NEUTRAL", "UNCLEAR", null]
            },
            "application": { 
              "type": ["string", "null"], 
              "enum": ["APPLIED", "MENTIONED_ONLY", "REJECTED", "NOT_CONSIDERED", "UNCLEAR", null]
            },
            "evidence": { "$ref": "#/definitions/evidence_nullable" }
          }
        },

        "factor_k_other_factors": {
          "type": "object",
          "description": "Art. 83(2)(k): Any other aggravating/mitigating factors.",
          "additionalProperties": false,
          "required": ["factors_present", "factor_list"],
          "properties": {
            "factors_present": { 
              "type": "boolean", 
              "description": "True if the DPA considered other factors beyond (a)–(j)." 
            },
            "factor_list": {
              "type": "array",
              "description": "List each 'other factor' separately. Use empty array if none.",
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": ["description", "effect", "application", "evidence"],
                "properties": {
                  "description": { 
                    "type": "string", 
                    "description": "E.g., 'Financial benefit', 'Market impact'." 
                  },
                  "effect": { 
                    "type": "string", 
                    "enum": ["AGGRAVATING", "MITIGATING", "NEUTRAL"]
                  },
                  "application": { 
                    "type": "string", 
                    "enum": ["APPLIED", "MENTIONED_ONLY", "REJECTED", "NOT_CONSIDERED", "UNCLEAR"]
                  },
                  "evidence": { "$ref": "#/definitions/evidence_nullable" }
                }
              }
            }
          }
        }
      }
    },

    "sanctions_imposed": {
      "type": "object",
      "description": "Final sanctions/corrective measures from the operative part.",
      "additionalProperties": false,
      "required": ["corrective_measures", "fine_details", "compliance_orders", "publication_requirement"],
      "properties": {
        "corrective_measures": {
          "type": "array",
          "minItems": 1,
          "uniqueItems": true,
          "items": { 
            "type": "string", 
            "enum": ["WARNING", "REPRIMAND", "COMPLIANCE_ORDER", "PROCESSING_BAN", "DATA_ERASURE_ORDER", "DATA_RECTIFICATION_ORDER", "NOTIFICATION_ORDER", "CERTIFICATION_WITHDRAWAL", "ADMINISTRATIVE_FINE", "DATA_FLOW_SUSPENSION", "OTHER", "NONE"] 
          },
          "description": "All measures imposed under Art. 58(2). Use ['NONE'] only if explicitly no measures imposed."
        },

        "fine_details": {
          "type": ["object", "null"],
          "description": "Administrative fine details. Use null if no fine imposed. POST-VALIDATION: Verify consistency with ADMINISTRATIVE_FINE in corrective_measures.",
          "additionalProperties": false,
          "required": ["total_amount", "currency", "per_defendant", "calculation_evidence", "determinative_factors", "legal_maximum"],
          "properties": {
            "total_amount": { 
              "type": ["number", "null"], 
              "description": "Use only if decision states a single total. Do NOT sum amounts. Use null if only per-defendant fines." 
            },
            "currency": { 
              "type": "string", 
              "pattern": "^[A-Z]{3}$", 
              "description": "ISO-4217 currency code (e.g., 'EUR')." 
            },
            "per_defendant": {
              "type": "array",
              "description": "Breakdown per entity. Use empty array if single total only.",
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": ["defendant_name", "amount"],
                "properties": {
                  "defendant_name": { 
                    "type": "string", 
                    "description": "Must match a name in parties_and_violation.defendants[].name." 
                  },
                  "amount": { 
                    "type": "number", 
                    "description": "Fine amount for this specific defendant (as printed)." 
                  }
                }
              }
            },
            "calculation_evidence": { 
              "$ref": "#/definitions/evidence_nullable", 
              "description": "Key paragraph explaining how the fine was determined." 
            },
            "determinative_factors": {
              "type": "array",
              "items": { 
                "type": "string", 
                "enum": ["a","b","c","d","e","f","g","h","i","j","k"] 
              },
              "uniqueItems": true,
              "description": "Letters explicitly cited as determinative. Use empty array if not specified."
            },
            "legal_maximum": {
              "type": "object",
              "description": "Legal maximum fine that could have been imposed.",
              "additionalProperties": false,
              "required": ["amount", "basis"],
              "properties": {
                "amount": { 
                  "type": ["number", "null"], 
                  "description": "Maximum amount if stated explicitly. Do NOT compute. Use null if not stated." 
                },
                "basis": { 
                  "type": "string", 
                  "enum": ["PERCENTAGE_TURNOVER", "FIXED_AMOUNT", "NOT_STATED"]
                }
              }
            }
          }
        },

        "compliance_orders": {
          "type": "array",
          "description": "Specific actions ordered. Use empty array if none.",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["order_description", "deadline"],
            "properties": {
              "order_description": { 
                "type": "string", 
                "description": "E.g., 'Delete unlawfully processed data within 3 months'." 
              },
              "deadline": { 
                "type": ["string", "null"], 
                "description": "Timeframe if specified. Use null if no deadline given." 
              }
            }
          }
        },

        "publication_requirement": { 
          "type": "boolean", 
          "description": "True if defendant must publicize the violation/decision (beyond normal DPA publication)." 
        }
      }
    },

    "annual_turnover": {
      "type": ["object", "null"],
      "description": "Overall annual turnover IF decision states a single consolidated figure for all. Otherwise use null and rely on per-defendant turnover.",
      "additionalProperties": false,
      "required": ["value", "evidence", "applies_to"],
      "properties": {
        "value": {
          "type": "object",
          "additionalProperties": false,
          "required": ["amount", "currency", "year", "scope"],
          "properties": {
            "amount": { 
              "type": "number", 
              "description": "Consolidated turnover amount as printed." 
            },
            "currency": { 
              "type": "string", 
              "pattern": "^[A-Z]{3}$", 
              "description": "ISO-4217 currency code." 
            },
            "year": { 
              "type": ["integer", "null"], 
              "description": "Financial year. Use null if not specified." 
            },
            "scope": { 
              "type": "string", 
              "enum": ["WORLDWIDE", "EU_ONLY", "NATIONAL", "UNCLEAR"]
            }
          }
        },
        "evidence": { 
          "$ref": "#/definitions/evidence_explicit_only",
          "description": "Must be EXPLICIT basis only - never infer turnover."
        },
        "applies_to": { 
          "type": "string", 
          "enum": ["ALL_DEFENDANTS", "PRIMARY_DEFENDANT"]
        }
      }
    }
  },

  "definitions": {
    "evidence_nullable": {
      "type": "object",
      "description": "Evidence for a coded value. Use null values when factor is NOT_MENTIONED.",
      "additionalProperties": false,
      "required": ["basis", "location", "quote", "reason"],
      "properties": {
        "basis": { 
          "type": ["string", "null"], 
          "enum": ["EXPLICIT", "INFERRED", null], 
          "description": "How the value is supported. Use null if NOT_MENTIONED." 
        },
        "location": { 
          "type": ["string", "null"], 
          "enum": ["FACTS", "ANALYSIS", "CALCULATION", "CONCLUSION", null], 
          "description": "Where the support appears. Use null if NOT_MENTIONED." 
        },
        "quote": { 
          "type": ["string", "null"], 
          "description": "Verbatim quote when basis=EXPLICIT. Use null otherwise." 
        },
        "reason": { 
          "type": ["string", "null"], 
          "description": "Rationale when basis=INFERRED. Use null otherwise." 
        }
      }
    },
    
    "evidence_explicit_only": {
      "type": "object",
      "description": "Evidence that must be explicit (for turnover and monetary values).",
      "additionalProperties": false,
      "required": ["basis", "location", "quote", "reason"],
      "properties": {
        "basis": { 
          "type": "string", 
          "const": "EXPLICIT", 
          "description": "Must be EXPLICIT - never infer monetary values." 
        },
        "location": { 
          "type": "string", 
          "enum": ["FACTS", "ANALYSIS", "CALCULATION", "CONCLUSION"]
        },
        "quote": { 
          "type": "string", 
          "description": "Verbatim quote showing the value." 
        },
        "reason": { 
          "type": "null", 
          "description": "Always null for explicit evidence." 
        }
      }
    }
  }
}