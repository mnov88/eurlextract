<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated EurLEX Extractor - Test Setup</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px;
            line-height: 1.6;
        }
        .test-section { 
            background: #f5f5f5; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px; 
        }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; }
        code { 
            background: #e9ecef; 
            padding: 2px 4px; 
            border-radius: 3px; 
            font-family: monospace;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover { background: #0056b3; }
        #test-results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>üß™ Integrated EurLEX Extractor - Test Setup</h1>
    
    <div class="test-section info">
        <h2>üìã Pre-Test Checklist</h2>
        <p>Before testing the integrated system, ensure:</p>
        <ul>
            <li>‚úÖ All files are in place in the <code>integrated-extractor/</code> directory</li>
            <li>‚úÖ Parent extractor files are accessible at <code>../legislation-extractor/</code> and <code>../case-law-extractor/</code></li>
            <li>‚úÖ Browser has internet connectivity for API calls</li>
            <li>‚úÖ CORS is handled (may need to use a local server or browser flags for testing)</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üîß Component Tests</h2>
        <p>Test individual components:</p>
        
        <button class="test-button" onclick="testAPIClient()">Test API Client</button>
        <button class="test-button" onclick="testArticleParser()">Test Article Parser</button>
        <button class="test-button" onclick="testExtractorClasses()">Test Extractor Classes</button>
        
        <div id="component-test-results"></div>
    </div>

    <div class="test-section warning">
        <h2>‚ö†Ô∏è CORS Notice</h2>
        <p>Due to CORS restrictions, direct API calls to EU Publications Office may fail when testing locally. 
        Consider:</p>
        <ul>
            <li>Using a local development server with CORS proxy</li>
            <li>Testing with browser CORS disabled (development only)</li>
            <li>Using a CORS browser extension</li>
            <li>Testing with mock XML data first</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üìÑ Sample CELEX IDs for Testing</h2>
        <div style="background: white; padding: 15px; border-radius: 5px; margin: 10px 0;">
            <h3>Legislative Documents:</h3>
            <ul>
                <li><code>32016R0679</code> - GDPR (General Data Protection Regulation)</li>
                <li><code>32014L0024</code> - Public Procurement Directive</li>
                <li><code>32018R1807</code> - Digital Content Directive</li>
            </ul>
            
            <h3>Case Law Documents:</h3>
            <ul>
                <li><code>62019CJ0311</code> - Facebook Ireland case</li>
                <li><code>62018CJ0507</code> - Max Schrems II case</li>
                <li><code>62017CJ0136</code> - GC and Others case</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>üöÄ Quick Test Workflow</h2>
        <ol>
            <li>Open <code>index.html</code> in your browser</li>
            <li>Enter a CELEX ID (try <code>32016R0679</code> for GDPR)</li>
            <li>Enable "Automatically fetch referenced case law"</li>
            <li>Click "Process Document"</li>
            <li>Switch between view tabs to see results</li>
            <li>Check "Combined View" for enhanced interpretation analysis</li>
            <li>Try exporting data in different formats</li>
        </ol>
    </div>

    <div id="test-results"></div>

    <script>
        // Include the classes for testing
        document.write('<script src="api-client.js"><\/script>');
        document.write('<script src="enhanced-article-parser.js"><\/script>');
        document.write('<script src="../legislation-extractor/app.js"><\/script>');
        document.write('<script src="../case-law-extractor/app.js"><\/script>');

        function testAPIClient() {
            const results = document.getElementById('component-test-results');
            results.innerHTML = '<div class="test-section info"><h3>Testing API Client...</h3>';
            
            try {
                const apiClient = new EUPublicationsAPIClient();
                results.innerHTML += '<p>‚úÖ EUPublicationsAPIClient instantiated successfully</p>';
                
                // Test CELEX validation
                const validCelex = apiClient.isValidCelexFormat('32016R0679');
                const invalidCelex = apiClient.isValidCelexFormat('invalid');
                
                if (validCelex && !invalidCelex) {
                    results.innerHTML += '<p>‚úÖ CELEX validation working correctly</p>';
                } else {
                    results.innerHTML += '<p>‚ùå CELEX validation failed</p>';
                }
                
                // Test document type detection
                const isLegislation = apiClient.isLikelyLegislation('32016R0679');
                const isCaseLaw = apiClient.isLikelyCaseLaw('62019CJ0311');
                
                if (isLegislation && isCaseLaw) {
                    results.innerHTML += '<p>‚úÖ Document type detection working</p>';
                } else {
                    results.innerHTML += '<p>‚ùå Document type detection failed</p>';
                }
                
                results.innerHTML += '</div>';
                
            } catch (error) {
                results.innerHTML += '<p>‚ùå API Client test failed: ' + error.message + '</p></div>';
            }
        }

        function testArticleParser() {
            const results = document.getElementById('component-test-results');
            results.innerHTML = '<div class="test-section info"><h3>Testing Enhanced Article Parser...</h3>';
            
            try {
                const parser = new EnhancedArticleParser();
                results.innerHTML += '<p>‚úÖ EnhancedArticleParser instantiated successfully</p>';
                
                // Test basic parsing
                const testRef = 'A06P1';
                const basicResult = parser.parseBasicArticleReference(testRef);
                
                if (basicResult.parsed && basicResult.parsed.includes('Article 6')) {
                    results.innerHTML += '<p>‚úÖ Basic article parsing working: ' + basicResult.parsed + '</p>';
                } else {
                    results.innerHTML += '<p>‚ùå Basic article parsing failed</p>';
                }
                
                // Test enhanced parsing
                const context = { court: 'Court of Justice', procedureType: 'preliminary ruling' };
                const enhancedResult = parser.parseWithInterpretation(testRef, context, 'strict interpretation');
                
                if (enhancedResult.intValue && enhancedResult.interpretation) {
                    results.innerHTML += '<p>‚úÖ Enhanced parsing working - INT Value: ' + enhancedResult.intValue + '</p>';
                } else {
                    results.innerHTML += '<p>‚ùå Enhanced parsing failed</p>';
                }
                
                results.innerHTML += '</div>';
                
            } catch (error) {
                results.innerHTML += '<p>‚ùå Article Parser test failed: ' + error.message + '</p></div>';
            }
        }

        function testExtractorClasses() {
            const results = document.getElementById('component-test-results');
            results.innerHTML = '<div class="test-section info"><h3>Testing Extractor Classes...</h3>';
            
            try {
                // Test if parent classes are available
                if (typeof EnhancedEurLexExtractor !== 'undefined') {
                    results.innerHTML += '<p>‚úÖ EnhancedEurLexExtractor class available</p>';
                } else {
                    results.innerHTML += '<p>‚ùå EnhancedEurLexExtractor class not found</p>';
                }
                
                if (typeof CaseLawExtractor !== 'undefined') {
                    results.innerHTML += '<p>‚úÖ CaseLawExtractor class available</p>';
                } else {
                    results.innerHTML += '<p>‚ùå CaseLawExtractor class not found</p>';
                }
                
                results.innerHTML += '</div>';
                
            } catch (error) {
                results.innerHTML += '<p>‚ùå Extractor Classes test failed: ' + error.message + '</p></div>';
            }
        }

        // Auto-run basic tests when page loads
        setTimeout(() => {
            const results = document.getElementById('test-results');
            results.innerHTML = '<div class="test-section success"><h2>üéØ Auto Test Results</h2>';
            
            // Check if we can access the main application files
            const scripts = document.querySelectorAll('script[src]');
            let scriptsLoaded = 0;
            scripts.forEach(script => {
                if (script.src) scriptsLoaded++;
            });
            
            results.innerHTML += '<p>üìä Scripts loaded: ' + scriptsLoaded + '</p>';
            results.innerHTML += '<p>üåê Current URL: ' + window.location.href + '</p>';
            results.innerHTML += '<p>‚è∞ Test run at: ' + new Date().toLocaleString() + '</p>';
            results.innerHTML += '</div>';
        }, 1000);
    </script>
</body>
</html>